$def with(templates)

$# declare all the elements here - it makes it easier to rearrange later
$code:
	projects = {}
	Project = namedtuple('Project', ['name', 'link', 'thumbnail'])

	projects["dfs"] = Project(_('Flight Sim World'), "/flightsimworld", "fsw.jpg")
	projects["mud"] = Project(_('MUD: Multi-User Deathtrap'), "/mud", "mud.png")
	projects["countdown"] = Project(_('Countdown To Extinction'), "/extinction", "countdown.png")
	projects["hats"] = Project(_('Obtain Hats For Glory!'), "/hats", "hats.png")
	projects["wetware"] = Project(_('Wetware'), "/wetware", "wetware.png")
	projects["muffins"] = Project(_('Stop! Engage Muffin Contraption'), "/muffins", "muffins.png")
	projects["minutegames"] = Project(_('Minute Games'), "/minutegames", "mtwi.jpg")
	projects["tachyon"] = Project(_('Tachyon'), "/tachyon", "tachyon.png")
	projects["stm"] = Project(_('Steam Transfer Manager'), "/stm", "")
	projects["img"] = Project(_('img'), "/img", "")
	projects["dreamtask"] = Project(_('Dreamtask'), "/dreamtask", "dreamtask.png")
	projects["euler"] = Project(_('Project Euler'), "/euler", "")
	projects["yodawg"] = Project(_('This Site'), "/meta", "")

	def getel(mosaicsize, height, name):
		return templates.element(mosaicsize, height, templates.item(projects[name]))

<div id="games" class="vertical-flow">
	<div class="horizontal-flow mosaic-cluster full-mosaic">
		$:getel("full", "400px", "dfs")
		
		$ elements = [getel("quarter", "200px", "mud"), getel("quarter", "200px", "countdown")]
		$:templates.cluster("vertical", "half", elements)
	</div>

	<div class="horizontal-flow mosaic-cluster full-mosaic">
		$ elements = [getel("quarter", "200px", "hats"), getel("quarter", "440px", "tachyon")]
		$:templates.cluster("vertical", "quarter", elements, "30%")
		<div class="vertical-flow mosaic-cluster full-mosaic" style="flex-basis: 70%;">
			$:getel("quarter", "400px", "wetware")

			$ elements = [getel("half", "480px", "muffins"), getel("half", "480px", "minutegames")]
			$:templates.cluster("horizontal", "half", elements)
		</div>	
	</div>
</div>